<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="turn.css"/>
</head>

<div id="target">
	<img src="http://www.abovethelaw.com/images/entries/animated%20siren%20gif%20animated%20siren%20gif%20animated%20siren%20gif%20drudge%20report.GIF" alt="Red flashy thingie" />
	<p>Some wicked cool red flashing thingie here, haven't found a free one yet but it's coming!</p>
	<audio autobuffer>
		<source src="27_yayQuery_party_line.ogg" />
		<source src="http://cdn.yayquery.org/ep/music/27_yayQuery_party_line.mp3" />
	</audio>
</div>
<h1 style="text-align: center;">Demo.</h1>

<script src="jquery.min.js"></script>
<script src="jquery-ui.min.js"></script>
<script src="turn.js"></script>
<script type="text/javascript">
$(document).ready(function(){
var
	$audio = $('#target audio'),
	audioOpt = {
		currVol: 0,
		maxVol: $audio[0].volume,
		isReady: false,
		timerIn: null,
		timerOut: null,
		fadeStep: 0.15
	};

$audio.bind('loadeddata', function (e) {
	console.log('Audio is ready');
	audioOpt.isReady = true;
});

$('#target').fold({
	side: 'right',
	autoCurl: true
});

$('#turn_wrapper').hover(
	// Play/fade in to the 'maxVolume'
	function () {
		console.log('Play audio');

		if (audioOpt.isReady) {
			$audio[0].volume = audioOpt.curVol = audioOpt.fadeStep;
			$audio[0].play();

			(function () {
				audioOpt.timerOut && clearTimeout(audioOpt.timerOut);

				audioOpt.timerIn = setTimeout(function () {
					if (audioOpt.curVol < audioOpt.maxVol) {
						$audio[0].volume = audioOpt.curVol = audioOpt.curVol + audioOpt.fadeStep >= 1 ? 1 : audioOpt.curVol + audioOpt.fadeStep;
						console.log('fadein', audioOpt.curVol);
						audioOpt.timerIn = setTimeout(arguments.callee, 150);
					}
					else {
						audioOpt.timerIn = null;
					}
				}, 20);
			}());
		}
	},
	// Pause/fade it out and reset currentTime to 0
	function () {
		console.log('Stop audio');
		if (audioOpt.isReady) {

			audioOpt.curVol = $audio[0].volume;

			(function () {
				audioOpt.timerIn && clearTimeout(audioOpt.timerIn);

				audioOpt.timerOut = setTimeout(function () {
					if (audioOpt.curVol !== 0) {
						$audio[0].volume = audioOpt.curVol = audioOpt.curVol - audioOpt.fadeStep < 0 ? 0 : audioOpt.curVol - audioOpt.fadeStep;
						console.log('fadeout', audioOpt.curVol);
						audioOpt.timerOut = setTimeout(arguments.callee, 150);
					}
					else {
						$audio[0].currentTime = 0.1;
						$audio[0].startTime = 0;
						$audio[0].pause();
						audioOpt.timerOut = null;
					}
				}, 20);
			}());
		}
	});
});
</script>
</body>
</html>
